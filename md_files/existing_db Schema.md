\-- WARNING: This schema is for context only and is not meant to be run.  
\-- Table order and constraints may not be valid for execution.

CREATE TABLE public.amenities (  
  id uuid NOT NULL DEFAULT uuid\_generate\_v4(),  
  society\_id uuid,  
  name character varying NOT NULL,  
  description text,  
  capacity integer CHECK (capacity \> 0),  
  hourly\_rate numeric DEFAULT 0 CHECK (hourly\_rate \>= 0::numeric),  
  deposit\_amount numeric DEFAULT 0 CHECK (deposit\_amount \>= 0::numeric),  
  advance\_booking\_days integer DEFAULT 30 CHECK (advance\_booking\_days \>= 0),  
  max\_hours\_per\_booking integer DEFAULT 8 CHECK (max\_hours\_per\_booking \> 0),  
  is\_active boolean DEFAULT true,  
  booking\_rules jsonb,  
  created\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT amenities\_pkey PRIMARY KEY (id),  
  CONSTRAINT amenities\_society\_id\_fkey FOREIGN KEY (society\_id) REFERENCES public.societies(id)  
);  
CREATE TABLE public.amenity\_bookings (  
  id uuid NOT NULL DEFAULT uuid\_generate\_v4(),  
  amenity\_id uuid,  
  resident\_id uuid,  
  booking\_date date NOT NULL CHECK (booking\_date \>= CURRENT\_DATE),  
  start\_time time without time zone NOT NULL,  
  end\_time time without time zone NOT NULL,  
  purpose text,  
  guest\_count integer DEFAULT 0 CHECK (guest\_count \>= 0),  
  total\_amount numeric CHECK (total\_amount \>= 0::numeric),  
  deposit\_paid numeric DEFAULT 0 CHECK (deposit\_paid \>= 0::numeric),  
  status USER-DEFINED DEFAULT 'pending'::booking\_status,  
  cancellation\_reason text,  
  cancellation\_date timestamp with time zone,  
  created\_at timestamp with time zone DEFAULT now(),  
  updated\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT amenity\_bookings\_pkey PRIMARY KEY (id),  
  CONSTRAINT amenity\_bookings\_resident\_id\_fkey FOREIGN KEY (resident\_id) REFERENCES public.user\_profiles(id),  
  CONSTRAINT amenity\_bookings\_amenity\_id\_fkey FOREIGN KEY (amenity\_id) REFERENCES public.amenities(id)  
);  
CREATE TABLE public.family\_members (  
  id uuid NOT NULL DEFAULT uuid\_generate\_v4(),  
  user\_id uuid,  
  name character varying NOT NULL,  
  relationship character varying NOT NULL,  
  age integer CHECK (age \> 0 AND age \< 150),  
  phone character varying CHECK (phone::text \~ '^(\\+91)?\[6-9\]\\d{9}$'::text),  
  occupation character varying,  
  date\_of\_birth date,  
  created\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT family\_members\_pkey PRIMARY KEY (id),  
  CONSTRAINT family\_members\_user\_id\_fkey FOREIGN KEY (user\_id) REFERENCES public.user\_profiles(id)  
);  
CREATE TABLE public.maintenance\_bills (  
  id uuid NOT NULL DEFAULT uuid\_generate\_v4(),  
  society\_id uuid,  
  resident\_id uuid,  
  billing\_month date NOT NULL,  
  base\_amount numeric NOT NULL CHECK (base\_amount \>= 0::numeric),  
  water\_charges numeric DEFAULT 0 CHECK (water\_charges \>= 0::numeric),  
  electricity\_charges numeric DEFAULT 0 CHECK (electricity\_charges \>= 0::numeric),  
  parking\_charges numeric DEFAULT 0 CHECK (parking\_charges \>= 0::numeric),  
  amenity\_charges numeric DEFAULT 0 CHECK (amenity\_charges \>= 0::numeric),  
  other\_charges numeric DEFAULT 0 CHECK (other\_charges \>= 0::numeric),  
  late\_fee numeric DEFAULT 0 CHECK (late\_fee \>= 0::numeric),  
  adjustment\_amount numeric DEFAULT 0,  
  sub\_total numeric NOT NULL CHECK (sub\_total \>= 0::numeric),  
  gst\_applicable boolean DEFAULT false,  
  gst\_amount numeric DEFAULT 0 CHECK (gst\_amount \>= 0::numeric),  
  total\_amount numeric NOT NULL CHECK (total\_amount \>= 0::numeric),  
  status USER-DEFINED DEFAULT 'draft'::bill\_status,  
  due\_date date NOT NULL,  
  payment\_date timestamp with time zone,  
  payment\_method character varying,  
  payment\_reference character varying,  
  bill\_url text,  
  receipt\_url text,  
  created\_by uuid,  
  created\_at timestamp with time zone DEFAULT now(),  
  updated\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT maintenance\_bills\_pkey PRIMARY KEY (id),  
  CONSTRAINT maintenance\_bills\_society\_id\_fkey FOREIGN KEY (society\_id) REFERENCES public.societies(id),  
  CONSTRAINT maintenance\_bills\_resident\_id\_fkey FOREIGN KEY (resident\_id) REFERENCES public.user\_profiles(id),  
  CONSTRAINT maintenance\_bills\_created\_by\_fkey FOREIGN KEY (created\_by) REFERENCES public.user\_profiles(id)  
);  
CREATE TABLE public.maintenance\_requests (  
  id uuid NOT NULL DEFAULT uuid\_generate\_v4(),  
  title character varying NOT NULL,  
  description text,  
  category USER-DEFINED NOT NULL,  
  priority USER-DEFINED DEFAULT 'medium'::request\_priority,  
  status USER-DEFINED DEFAULT 'submitted'::request\_status,  
  location character varying,  
  resident\_id uuid,  
  society\_id uuid,  
  assigned\_vendor\_id uuid,  
  estimated\_cost numeric CHECK (estimated\_cost \>= 0::numeric),  
  actual\_cost numeric CHECK (actual\_cost \>= 0::numeric),  
  estimated\_completion date,  
  completion\_date timestamp with time zone,  
  photos ARRAY,  
  voice\_note\_url text,  
  resident\_rating integer CHECK (resident\_rating \>= 1 AND resident\_rating \<= 5),  
  resident\_feedback text,  
  committee\_notes text,  
  created\_at timestamp with time zone DEFAULT now(),  
  updated\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT maintenance\_requests\_pkey PRIMARY KEY (id),  
  CONSTRAINT maintenance\_requests\_assigned\_vendor\_id\_fkey FOREIGN KEY (assigned\_vendor\_id) REFERENCES public.vendors(id),  
  CONSTRAINT maintenance\_requests\_resident\_id\_fkey FOREIGN KEY (resident\_id) REFERENCES public.user\_profiles(id),  
  CONSTRAINT maintenance\_requests\_society\_id\_fkey FOREIGN KEY (society\_id) REFERENCES public.societies(id)  
);  
CREATE TABLE public.notices (  
  id uuid NOT NULL DEFAULT uuid\_generate\_v4(),  
  title text NOT NULL,  
  content text NOT NULL,  
  priority text DEFAULT 'medium'::text CHECK (priority \= ANY (ARRAY\['low'::text, 'medium'::text, 'high'::text, 'urgent'::text\])),  
  target\_type text DEFAULT 'all'::text CHECK (target\_type \= ANY (ARRAY\['all'::text, 'apartment'::text, 'building'::text, 'custom'::text\])),  
  target\_apartments ARRAY,  
  target\_buildings ARRAY,  
  target\_user\_ids ARRAY,  
  created\_by uuid,  
  expires\_at timestamp with time zone,  
  is\_active boolean DEFAULT true,  
  created\_at timestamp with time zone DEFAULT now(),  
  updated\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT notices\_pkey PRIMARY KEY (id),  
  CONSTRAINT notices\_created\_by\_fkey FOREIGN KEY (created\_by) REFERENCES auth.users(id)  
);  
CREATE TABLE public.notification\_logs (  
  id uuid NOT NULL DEFAULT uuid\_generate\_v4(),  
  user\_id uuid,  
  category character varying NOT NULL,  
  title character varying NOT NULL,  
  message text NOT NULL,  
  type character varying CHECK (type::text \= ANY (ARRAY\['push'::character varying, 'email'::character varying, 'sms'::character varying, 'whatsapp'::character varying\]::text\[\])),  
  status character varying CHECK (status::text \= ANY (ARRAY\['pending'::character varying, 'sent'::character varying, 'delivered'::character varying, 'failed'::character varying\]::text\[\])),  
  delivery\_attempt integer DEFAULT 1 CHECK (delivery\_attempt \> 0),  
  delivered\_at timestamp with time zone,  
  failed\_reason text,  
  metadata jsonb,  
  read\_at timestamp with time zone,  
  created\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT notification\_logs\_pkey PRIMARY KEY (id),  
  CONSTRAINT notification\_logs\_user\_id\_fkey FOREIGN KEY (user\_id) REFERENCES public.user\_profiles(id)  
);  
CREATE TABLE public.notification\_preferences (  
  id uuid NOT NULL DEFAULT uuid\_generate\_v4(),  
  user\_id uuid UNIQUE,  
  maintenance\_enabled boolean DEFAULT true,  
  billing\_enabled boolean DEFAULT true,  
  events\_enabled boolean DEFAULT true,  
  security\_enabled boolean DEFAULT true,  
  committee\_enabled boolean DEFAULT true,  
  visitors\_enabled boolean DEFAULT true,  
  amenities\_enabled boolean DEFAULT true,  
  vendors\_enabled boolean DEFAULT false,  
  emergency\_enabled boolean DEFAULT true,  
  push\_enabled boolean DEFAULT true,  
  email\_enabled boolean DEFAULT true,  
  sms\_enabled boolean DEFAULT false,  
  whatsapp\_enabled boolean DEFAULT false,  
  dnd\_start\_time time without time zone DEFAULT '22:00:00'::time without time zone,  
  dnd\_end\_time time without time zone DEFAULT '07:00:00'::time without time zone,  
  dnd\_enabled boolean DEFAULT false,  
  created\_at timestamp with time zone DEFAULT now(),  
  updated\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT notification\_preferences\_pkey PRIMARY KEY (id),  
  CONSTRAINT notification\_preferences\_user\_id\_fkey FOREIGN KEY (user\_id) REFERENCES public.user\_profiles(id)  
);  
CREATE TABLE public.payments (  
  id uuid NOT NULL DEFAULT uuid\_generate\_v4(),  
  bill\_id uuid,  
  resident\_id uuid,  
  amount numeric NOT NULL CHECK (amount \> 0::numeric),  
  payment\_method character varying NOT NULL,  
  gateway\_provider character varying,  
  gateway\_payment\_id character varying,  
  gateway\_order\_id character varying,  
  gateway\_signature character varying,  
  status USER-DEFINED DEFAULT 'pending'::payment\_status,  
  failure\_reason text,  
  receipt\_url text,  
  processed\_at timestamp with time zone,  
  created\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT payments\_pkey PRIMARY KEY (id),  
  CONSTRAINT payments\_resident\_id\_fkey FOREIGN KEY (resident\_id) REFERENCES public.user\_profiles(id),  
  CONSTRAINT payments\_bill\_id\_fkey FOREIGN KEY (bill\_id) REFERENCES public.maintenance\_bills(id)  
);  
CREATE TABLE public.societies (  
  id uuid NOT NULL DEFAULT uuid\_generate\_v4(),  
  name character varying NOT NULL,  
  code character varying NOT NULL UNIQUE,  
  address text NOT NULL,  
  city character varying NOT NULL,  
  state character varying NOT NULL,  
  pin\_code character varying NOT NULL CHECK (pin\_code::text \~ '^\[1-9\]\[0-9\]{5}$'::text),  
  total\_flats integer NOT NULL CHECK (total\_flats \> 0),  
  total\_buildings integer DEFAULT 1 CHECK (total\_buildings \> 0),  
  gst\_number character varying CHECK (gst\_number::text \~ '^\[0-9\]{2}\[A-Z\]{5}\[0-9\]{4}\[A-Z\]{1}\[1-9A-Z\]{1}Z\[0-9A-Z\]{1}$'::text),  
  registration\_number character varying,  
  contact\_email character varying CHECK (contact\_email::text \~ '^\[^@\]+@\[^@\]+\\.\[^@\]+$'::text),  
  contact\_phone character varying CHECK (contact\_phone::text \~ '^(\\+91)?\[6-9\]\\d{9}$'::text),  
  maintenance\_amount numeric DEFAULT 0 CHECK (maintenance\_amount \>= 0::numeric),  
  is\_active boolean DEFAULT true,  
  created\_at timestamp with time zone DEFAULT now(),  
  updated\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT societies\_pkey PRIMARY KEY (id)  
);  
CREATE TABLE public.society\_expenses (  
  id uuid NOT NULL DEFAULT uuid\_generate\_v4(),  
  society\_id uuid,  
  category character varying NOT NULL,  
  description text NOT NULL,  
  amount numeric NOT NULL CHECK (amount \>= 0::numeric),  
  vendor\_id uuid,  
  invoice\_number character varying,  
  invoice\_date date,  
  gst\_amount numeric DEFAULT 0 CHECK (gst\_amount \>= 0::numeric),  
  approved\_by uuid,  
  approval\_date timestamp with time zone,  
  payment\_status character varying DEFAULT 'pending'::character varying CHECK (payment\_status::text \= ANY (ARRAY\['pending'::character varying, 'approved'::character varying, 'paid'::character varying, 'rejected'::character varying\]::text\[\])),  
  receipt\_url text,  
  invoice\_url text,  
  created\_by uuid,  
  created\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT society\_expenses\_pkey PRIMARY KEY (id),  
  CONSTRAINT society\_expenses\_created\_by\_fkey FOREIGN KEY (created\_by) REFERENCES public.user\_profiles(id),  
  CONSTRAINT society\_expenses\_approved\_by\_fkey FOREIGN KEY (approved\_by) REFERENCES public.user\_profiles(id),  
  CONSTRAINT society\_expenses\_vendor\_id\_fkey FOREIGN KEY (vendor\_id) REFERENCES public.vendors(id),  
  CONSTRAINT society\_expenses\_society\_id\_fkey FOREIGN KEY (society\_id) REFERENCES public.societies(id)  
);  
CREATE TABLE public.user\_profiles (  
  id uuid NOT NULL,  
  phone character varying NOT NULL UNIQUE CHECK (phone::text \~ '^(\\+91)?\[6-9\]\\d{9}$'::text),  
  full\_name character varying NOT NULL,  
  role USER-DEFINED NOT NULL,  
  society\_id uuid,  
  flat\_number character varying,  
  building\_name character varying,  
  floor\_number integer CHECK (floor\_number \> 0),  
  is\_owner boolean DEFAULT false,  
  is\_primary\_contact boolean DEFAULT false,  
  emergency\_contact\_name character varying,  
  emergency\_contact\_phone character varying CHECK (emergency\_contact\_phone::text \~ '^(\\+91)?\[6-9\]\\d{9}$'::text),  
  occupation character varying,  
  date\_of\_birth date,  
  profile\_image\_url text,  
  is\_verified boolean DEFAULT false,  
  verification\_requested\_at timestamp with time zone,  
  verified\_by uuid,  
  verified\_at timestamp with time zone,  
  verification\_notes text,  
  created\_at timestamp with time zone DEFAULT now(),  
  updated\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT user\_profiles\_pkey PRIMARY KEY (id),  
  CONSTRAINT user\_profiles\_society\_id\_fkey FOREIGN KEY (society\_id) REFERENCES public.societies(id),  
  CONSTRAINT user\_profiles\_verified\_by\_fkey FOREIGN KEY (verified\_by) REFERENCES auth.users(id),  
  CONSTRAINT user\_profiles\_id\_fkey FOREIGN KEY (id) REFERENCES auth.users(id)  
);  
CREATE TABLE public.users (  
  id uuid NOT NULL,  
  email text NOT NULL UNIQUE,  
  first\_name text NOT NULL,  
  last\_name text NOT NULL,  
  fcm\_token text,  
  created\_at timestamp with time zone DEFAULT now(),  
  updated\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT users\_pkey PRIMARY KEY (id),  
  CONSTRAINT users\_id\_fkey FOREIGN KEY (id) REFERENCES auth.users(id)  
);  
CREATE TABLE public.vehicles (  
  id uuid NOT NULL DEFAULT uuid\_generate\_v4(),  
  user\_id uuid,  
  vehicle\_type character varying CHECK (vehicle\_type::text \= ANY (ARRAY\['car'::character varying, 'bike'::character varying, 'bicycle'::character varying, 'scooter'::character varying, 'other'::character varying\]::text\[\])),  
  vehicle\_number character varying NOT NULL,  
  brand character varying,  
  model character varying,  
  color character varying,  
  parking\_slot character varying,  
  is\_active boolean DEFAULT true,  
  created\_at timestamp with time zone DEFAULT now(),  
  updated\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT vehicles\_pkey PRIMARY KEY (id),  
  CONSTRAINT vehicles\_user\_id\_fkey FOREIGN KEY (user\_id) REFERENCES public.user\_profiles(id)  
);  
CREATE TABLE public.vendor\_assignments (  
  id uuid NOT NULL DEFAULT uuid\_generate\_v4(),  
  maintenance\_request\_id uuid,  
  vendor\_id uuid,  
  assigned\_by uuid,  
  assigned\_at timestamp with time zone DEFAULT now(),  
  estimated\_cost numeric CHECK (estimated\_cost \>= 0::numeric),  
  estimated\_completion date,  
  notes text,  
  CONSTRAINT vendor\_assignments\_pkey PRIMARY KEY (id),  
  CONSTRAINT vendor\_assignments\_vendor\_id\_fkey FOREIGN KEY (vendor\_id) REFERENCES public.vendors(id),  
  CONSTRAINT vendor\_assignments\_maintenance\_request\_id\_fkey FOREIGN KEY (maintenance\_request\_id) REFERENCES public.maintenance\_requests(id),  
  CONSTRAINT vendor\_assignments\_assigned\_by\_fkey FOREIGN KEY (assigned\_by) REFERENCES public.user\_profiles(id)  
);  
CREATE TABLE public.vendors (  
  id uuid NOT NULL DEFAULT uuid\_generate\_v4(),  
  name character varying NOT NULL,  
  category USER-DEFINED NOT NULL,  
  contact\_person character varying,  
  phone character varying NOT NULL CHECK (phone::text \~ '^(\\+91)?\[6-9\]\\d{9}$'::text),  
  email character varying CHECK (email::text \~ '^\[^@\]+@\[^@\]+\\.\[^@\]+$'::text),  
  address text,  
  gst\_number character varying CHECK (gst\_number::text \~ '^\[0-9\]{2}\[A-Z\]{5}\[0-9\]{4}\[A-Z\]{1}\[1-9A-Z\]{1}Z\[0-9A-Z\]{1}$'::text),  
  pan\_number character varying CHECK (pan\_number::text \~ '^\[A-Z\]{5}\[0-9\]{4}\[A-Z\]{1}$'::text),  
  is\_verified boolean DEFAULT false,  
  is\_active boolean DEFAULT true,  
  verification\_documents ARRAY,  
  rating numeric DEFAULT 0 CHECK (rating \>= 0::numeric AND rating \<= 5::numeric),  
  total\_jobs integer DEFAULT 0 CHECK (total\_jobs \>= 0),  
  completed\_jobs integer DEFAULT 0 CHECK (completed\_jobs \>= 0),  
  created\_at timestamp with time zone DEFAULT now(),  
  updated\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT vendors\_pkey PRIMARY KEY (id)  
);  
CREATE TABLE public.visitors (  
  id uuid NOT NULL DEFAULT uuid\_generate\_v4(),  
  name text NOT NULL,  
  contact\_number text NOT NULL,  
  visit\_date date NOT NULL,  
  visit\_time time without time zone NOT NULL,  
  visit\_purpose text NOT NULL,  
  status USER-DEFINED,  
  created\_at timestamp with time zone DEFAULT now(),  
  updated\_at timestamp with time zone DEFAULT now(),  
  CONSTRAINT visitors\_pkey PRIMARY KEY (id)  
);  
